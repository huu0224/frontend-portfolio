<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>FE Physics Interaction</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; }
        .ui-guide {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.4); pointer-events: none; text-align: center;
        }
    </style>
</head>
<body>

<div class="ui-guide">
    <h2 style="color: #4f46e5; margin: 0;">PHYSICS ENGINE</h2>
    <p>공들을 마우스로 드래그하거나 클릭하여 던져보세요.</p>
</div>
<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let balls = [];
    const gravity = 0.5; // 중력 가속도
    const friction = 0.98; // 마찰력 (에너지 손실)
    const mouse = { x: 0, y: 0, isDown: false, target: null };

    window.addEventListener('resize', init);
    window.addEventListener('mousedown', (e) => {
        mouse.isDown = true;
        balls.forEach(b => {
            const d = Math.sqrt((e.x - b.x)**2 + (e.y - b.y)**2);
            if (d < b.r) mouse.target = b;
        });
    });
    window.addEventListener('mouseup', () => {
        mouse.isDown = false;
        mouse.target = null;
    });
    window.addEventListener('mousemove', (e) => {
        if (mouse.isDown && mouse.target) {
            mouse.target.vx = e.clientX - mouse.target.x;
            mouse.target.vy = e.clientY - mouse.target.y;
            mouse.target.x = e.clientX;
            mouse.target.y = e.clientY;
        }
    });

    class Ball {
        constructor(x, y, r, color) {
            this.x = x; this.y = y; this.r = r;
            this.color = color;
            this.vx = (Math.random() - 0.5) * 20;
            this.vy = (Math.random() - 0.5) * 20;
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.closePath();
        }
        update() {
            if (this !== mouse.target) {
                this.vy += gravity; // 중력 적용
                this.vx *= friction; // 공기 저항
                this.vy *= friction;
                this.x += this.vx;
                this.y += this.vy;

                // 바닥/벽 충돌 처리
                if (this.y + this.r > canvas.height) {
                    this.y = canvas.height - this.r;
                    this.vy *= -0.7; // 튕김 계수
                }
                if (this.x + this.r > canvas.width || this.x - this.r < 0) {
                    this.vx *= -0.7;
                    this.x = this.x < this.r ? this.r : canvas.width - this.r;
                }
            }
            this.draw();
        }
    }

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        balls = [];
        const colors = ['#4f46e5', '#ec4899', '#10b981', '#f59e0b', '#3b82f6'];
        for (let i = 0; i < 15; i++) {
            balls.push(new Ball(
                Math.random() * canvas.width,
                Math.random() * canvas.height / 2,
                Math.random() * 30 + 20,
                colors[i % 5]
            ));
        }
    }

    function animate() {
        ctx.fillStyle = 'rgba(5, 5, 5, 0.3)'; // 잔상 효과
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 공 사이의 충돌 처리 ( momentum )
        for (let i = 0; i < balls.length; i++) {
            for (let j = i + 1; j < balls.length; j++) {
                const dx = balls[j].x - balls[i].x;
                const dy = balls[j].y - balls[i].y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < balls[i].r + balls[j].r) {
                    // 간단한 탄성 충돌 로직
                    [balls[i].vx, balls[j].vx] = [balls[j].vx, balls[i].vx];
                    [balls[i].vy, balls[j].vy] = [balls[j].vy, balls[i].vy];
                }
            }
            balls[i].update();
        }
        requestAnimationFrame(animate);
    }

    init();
    animate();
</script>
</body>
</html>